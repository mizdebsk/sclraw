From 883c04ab230c35aa7c020fae57d4e94ab1c4673a Mon Sep 17 00:00:00 2001
From: Mikolaj Izdebski <mizdebsk@redhat.com>
Date: Fri, 15 Jul 2016 08:39:57 +0200
Subject: [PATCH 5/5] Avoid duplicate MOJO parameters

---
 .../JavaAnnotationsMojoDescriptorExtractor.java    | 24 ++++++++++++++++++++--
 1 file changed, 22 insertions(+), 2 deletions(-)

diff --git a/maven-plugin-tools-annotations/src/main/java/org/apache/maven/tools/plugin/extractor/annotations/JavaAnnotationsMojoDescriptorExtractor.java b/maven-plugin-tools-annotations/src/main/java/org/apache/maven/tools/plugin/extractor/annotations/JavaAnnotationsMojoDescriptorExtractor.java
index fb29b8c..893e0a1 100644
--- a/maven-plugin-tools-annotations/src/main/java/org/apache/maven/tools/plugin/extractor/annotations/JavaAnnotationsMojoDescriptorExtractor.java
+++ b/maven-plugin-tools-annotations/src/main/java/org/apache/maven/tools/plugin/extractor/annotations/JavaAnnotationsMojoDescriptorExtractor.java
@@ -25,6 +25,7 @@ import java.util.Arrays;
 import java.util.Collection;
 import java.util.Collections;
 import java.util.HashMap;
+import java.util.Iterator;
 import java.util.List;
 import java.util.Map;
 import java.util.TreeSet;
@@ -188,7 +189,7 @@ public class JavaAnnotationsMojoDescriptorExtractor
                 parameter.setSince( parameterAnnotationContent.getSince() );
                 parameter.setRequired( parameterAnnotationContent.required() );
 
-                mojoDescriptor.addParameter( parameter );
+                addParameter( mojoDescriptor, parameter );
             }
 
             // Component annotations
@@ -229,7 +230,7 @@ public class JavaAnnotationsMojoDescriptorExtractor
                 //parameter.setRequired( ... );
                 parameter.setEditable( false );
 
-                mojoDescriptor.addParameter( parameter );
+                addParameter( mojoDescriptor, parameter );
             }
 
             mojoDescriptor.setPluginDescriptor( pluginDescriptor );
@@ -239,6 +240,25 @@ public class JavaAnnotationsMojoDescriptorExtractor
         return mojoDescriptors;
     }
 
+    private void addParameter( ExtendedMojoDescriptor mojoDescriptor,
+                               org.apache.maven.plugin.descriptor.Parameter parameter )
+        throws DuplicateParameterException
+    {
+        if ( mojoDescriptor.getParameters() != null )
+        {
+            for ( Iterator<?> it = mojoDescriptor.getParameters().iterator(); it.hasNext(); )
+            {
+                if ( it.next().equals( parameter ) )
+                {
+                    getLogger().warn( "Duplicate parameter " + parameter.getName() + " field in MOJO descriptor" );
+                    it.remove();
+                }
+            }
+        }
+
+        mojoDescriptor.addParameter( parameter );
+    }
+
     protected ExecuteAnnotationContent findExecuteInParentHierarchy( MojoAnnotatedClass mojoAnnotatedClass,
                                                                  Map<String, MojoAnnotatedClass> mojoAnnotatedClasses )
     {
-- 
2.7.4

